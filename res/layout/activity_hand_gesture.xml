<?xml version="1.0" encoding="utf-8"?>
<FrameLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/bg_dark">

    <!-- Live camera preview (background) -->
    <androidx.camera.view.PreviewView
        android:id="@+id/previewViewGesture"
        android:layout_width="match_parent"
        android:layout_height="match_parent"/>

    <!-- Dark scrim for readability -->
    <View
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:background="#CC0A0A0F"/>

    <!-- SCROLLABLE CONTENT -->
    <ScrollView
        android:layout_width="match_parent"
        android:layout_height="match_parent">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="20dp">

            <!-- Back -->
            <TextView
                android:id="@+id/tvGestureBack"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="â† Back"
                android:textColor="#AA9DB4BF"
                android:textSize="15sp"
                android:paddingTop="12dp"
                android:paddingBottom="6dp"/>

            <!-- Title -->
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Finger Gesture SOS"
                android:textColor="#FFFFFF"
                android:textSize="26sp"
                android:textStyle="bold"/>

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Point â˜ one finger â€¢ hold 4 sec â€¢ SOS triggers"
                android:textColor="#AA9DB4BF"
                android:textSize="12sp"
                android:layout_marginTop="3dp"
                android:layout_marginBottom="18dp"/>

            <!-- ===== ANIMATED FINGER + DETECTION ZONE ===== -->
            <FrameLayout
                android:layout_width="match_parent"
                android:layout_height="240dp"
                android:layout_marginBottom="18dp">

                <!-- Detection zone box -->
                <View
                    android:layout_width="160dp"
                    android:layout_height="160dp"
                    android:layout_gravity="center"
                    android:background="#1AFF2D55"/>

                <!-- Dashed border simulation (4 corner marks) -->
                <View android:layout_width="20dp" android:layout_height="3dp"
                    android:layout_gravity="center" android:translationX="-80dp" android:translationY="-80dp"
                    android:background="#FF2D55"/>
                <View android:layout_width="3dp" android:layout_height="20dp"
                    android:layout_gravity="center" android:translationX="-80dp" android:translationY="-80dp"
                    android:background="#FF2D55"/>
                <View android:layout_width="20dp" android:layout_height="3dp"
                    android:layout_gravity="center" android:translationX="80dp" android:translationY="-80dp"
                    android:background="#FF2D55"/>
                <View android:layout_width="3dp" android:layout_height="20dp"
                    android:layout_gravity="center" android:translationX="80dp" android:translationY="-80dp"
                    android:background="#FF2D55"/>
                <View android:layout_width="20dp" android:layout_height="3dp"
                    android:layout_gravity="center" android:translationX="-80dp" android:translationY="80dp"
                    android:background="#FF2D55"/>
                <View android:layout_width="3dp" android:layout_height="20dp"
                    android:layout_gravity="center" android:translationX="-80dp" android:translationY="80dp"
                    android:background="#FF2D55"/>
                <View android:layout_width="20dp" android:layout_height="3dp"
                    android:layout_gravity="center" android:translationX="80dp" android:translationY="80dp"
                    android:background="#FF2D55"/>
                <View android:layout_width="3dp" android:layout_height="20dp"
                    android:layout_gravity="center" android:translationX="80dp" android:translationY="80dp"
                    android:background="#FF2D55"/>

                <!-- Ripple ring (shown during detection) -->
                <ImageView
                    android:id="@+id/ivRipple"
                    android:layout_width="140dp"
                    android:layout_height="140dp"
                    android:layout_gravity="center"
                    android:src="@drawable/ic_finger_pulse"
                    android:alpha="0.4"
                    android:visibility="gone"/>

                <!-- Finger vector (idle, pulsing) -->
                <ImageView
                    android:id="@+id/ivFingerVector"
                    android:layout_width="90dp"
                    android:layout_height="90dp"
                    android:layout_gravity="center"
                    android:src="@drawable/ic_finger_point"/>

                <!-- Label -->
                <LinearLayout
                    android:id="@+id/layoutGestureReady"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_gravity="bottom"
                    android:gravity="center"
                    android:orientation="vertical"
                    android:paddingBottom="8dp">

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="â–²  Point single finger into zone  â–²"
                        android:textColor="#66FFFFFF"
                        android:textSize="11sp"
                        android:gravity="center"/>
                </LinearLayout>

                <!-- COUNTING OVERLAY -->
                <LinearLayout
                    android:id="@+id/layoutGestureOverlay"
                    android:layout_width="match_parent"
                    android:layout_height="match_parent"
                    android:orientation="vertical"
                    android:gravity="center"
                    android:background="#DD150010"
                    android:visibility="gone">

                    <TextView
                        android:id="@+id/tvGestureCountdown"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="4"
                        android:textColor="#FF2D55"
                        android:textSize="72sp"
                        android:textStyle="bold"
                        android:layout_marginBottom="10dp"/>

                    <ProgressBar
                        android:id="@+id/progressGestureRing"
                        style="@android:style/Widget.ProgressBar.Horizontal"
                        android:layout_width="180dp"
                        android:layout_height="16dp"
                        android:max="100"
                        android:progress="0"
                        android:progressTint="#FF2D55"
                        android:progressBackgroundTint="#33FF2D55"
                        android:layout_marginBottom="10dp"/>

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="Keep finger steadyâ€¦"
                        android:textColor="#CCFFFFFF"
                        android:textSize="13sp"/>
                </LinearLayout>

            </FrameLayout>

            <!-- Status bar -->
            <TextView
                android:id="@+id/tvGestureStatus"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="â˜ Point one finger at the front camera"
                android:textColor="#FFFFFF"
                android:textSize="15sp"
                android:gravity="center"
                android:background="#33FFFFFF"
                android:padding="14dp"
                android:layout_marginBottom="8dp"/>

            <!-- Live debug readout (helps user understand detection) -->
            <TextView
                android:id="@+id/tvGestureDebug"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="zone=â€”  frame=â€”  ratio=â€”"
                android:textColor="#55FF2D55"
                android:textSize="11sp"
                android:fontFamily="monospace"
                android:gravity="center"
                android:layout_marginBottom="18dp"/>

            <!-- Enable this screen's detection switch -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                android:gravity="center_vertical"
                android:background="#1AFFFFFF"
                android:paddingStart="16dp"
                android:paddingEnd="16dp"
                android:paddingTop="14dp"
                android:paddingBottom="14dp"
                android:layout_marginBottom="12dp">

                <LinearLayout
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:orientation="vertical">
                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="Live Detection (this screen)"
                        android:textColor="#FFFFFF"
                        android:textSize="14sp"
                        android:textStyle="bold"/>
                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="Detects finger while screen is open"
                        android:textColor="#779DB4BF"
                        android:textSize="11sp"/>
                </LinearLayout>

                <Switch
                    android:id="@+id/switchGestureEnable"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:checked="true"/>
            </LinearLayout>

            <!-- Background service toggle -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                android:gravity="center_vertical"
                android:background="#1A7C3AED"
                android:paddingStart="16dp"
                android:paddingEnd="16dp"
                android:paddingTop="14dp"
                android:paddingBottom="14dp"
                android:layout_marginBottom="18dp">

                <LinearLayout
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:orientation="vertical">
                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="Background Detection"
                        android:textColor="#FFFFFF"
                        android:textSize="14sp"
                        android:textStyle="bold"/>
                    <TextView
                        android:id="@+id/tvBgGestureStatus"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="Monitors camera even when app is minimised"
                        android:textColor="#779DB4BF"
                        android:textSize="11sp"/>
                </LinearLayout>

                <Switch
                    android:id="@+id/switchBgGesture"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:checked="false"/>
            </LinearLayout>

            <!-- Tip -->
            <TextView
                android:id="@+id/tvGestureTip"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="ðŸ’¡ How it works: The front camera analyses each frame for a single raised index finger. When exactly one narrow tall peak is detected in the frame for 4 continuous seconds, SOS triggers â€” sending SMS, sounding alarm, and recording evidence.\n\nBackground mode uses extra battery. Disable when not needed."
                android:textColor="#669DB4BF"
                android:textSize="12sp"
                android:lineSpacingExtra="4dp"
                android:layout_marginBottom="30dp"/>

        </LinearLayout>
    </ScrollView>
</FrameLayout>
